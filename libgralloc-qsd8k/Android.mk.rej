--- libgralloc-qsd8k/Android.mk
+++ libgralloc-qsd8k/Android.mk
@@ -30,9 +30,29 @@
 	pmemalloc.cpp
 	
 LOCAL_MODULE := gralloc.$(TARGET_BOARD_PLATFORM)
+LOCAL_MODULE_TAGS := optional
 LOCAL_CFLAGS:= -DLOG_TAG=\"$(TARGET_BOARD_PLATFORM).gralloc\"
+
+ifneq (, $(filter msm7625_ffa msm7625_surf msm7627_ffa msm7627_surf msm7627_7x_ffa msm7627_7x_surf, $(QCOM_TARGET_PRODUCT)))
+LOCAL_CFLAGS += -DTARGET_MSM7x27
+endif
+
+ifeq ($(TARGET_HAVE_HDMI_OUT),true)
+LOCAL_CFLAGS += -DHDMI_DUAL_DISPLAY
+LOCAL_C_INCLUDES += $(LOCAL_PATH)/../liboverlay
+LOCAL_SHARED_LIBRARIES += liboverlay
+endif
+
+ifeq ($(TARGET_USES_SF_BYPASS),true)
+LOCAL_CFLAGS += -DSF_BYPASS
+endif
+
+
+LOCAL_CFLAGS += -DUSE_ASHMEM
+
 include $(BUILD_SHARED_LIBRARY)
 
+
 # Build a host library for testing
 ifeq ($(HOST_OS),linux)
 include $(CLEAR_VARS)
